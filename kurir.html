<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Kurir</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Inter',sans-serif; margin:0; background:#f3f6f9; color:#0f172a; }
    .wrap { max-width: 900px; margin: 20px auto; padding: 0 16px; }
    h1 { margin: 8px 0 16px; }
    .card { background:#fff; border-radius:10px; padding:16px; box-shadow:0 6px 16px rgba(0,0,0,0.08); }
    table { width:100%; border-collapse: collapse; }
    th, td { text-align:left; padding:10px; border-bottom:1px solid #e5e7eb; }
    th { background:#f8fafc; }
    .actions { display:flex; gap:8px; }
    .btn { border:none; border-radius:8px; padding:8px 12px; cursor:pointer; }
    .btn.primary { background:#2563eb; color:#fff; }
    .btn.secondary { background:#e5e7eb; color:#111827; }
    select { padding:8px; border:1px solid #cbd5e1; border-radius:8px; }
  </style>
  <script src="assets/js/api.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>Panel Kurir</h1>
    <div class="card">
      <table>
        <thead>
          <tr><th>ID Pengiriman</th><th>ID Pesanan</th><th>No Resi</th><th>Status</th><th>Aksi</th></tr>
        </thead>
        <tbody id="shipTbody"></tbody>
      </table>
    </div>
  </div>

  <script>
    async function loadShipments(){
      const resp = await API.authFetch('/kurir/shipments');
      if (!resp.ok) { API.showModal({ title:'Kurir', message:'Gagal memuat data' }); return; }
      const rows = await resp.json();
      const tb = document.getElementById('shipTbody');
      tb.innerHTML = '';
      rows.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.peneriman_id}</td><td>${s.pesanan_id}</td><td>${s.no_resi||'-'}</td><td>${s.status_kirim}</td>
          <td class='actions'>
            <select onchange="updateStatus(${s.peneriman_id}, this.value)">
              <option value='diproses' ${s.status_kirim==='diproses'?'selected':''}>Diproses</option>
              <option value='dikirim' ${s.status_kirim==='dikirim'?'selected':''}>Dikirim</option>
              <option value='diterima' ${s.status_kirim==='diterima'?'selected':''}>Diterima</option>
            </select>
          </td>`;
        tb.appendChild(tr);
      });
    }
    async function updateStatus(id, status_kirim){
      const resp = await API.authFetch('/shipments/' + id + '/status', { method:'PATCH', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ status_kirim }) });
      if (!resp.ok) { API.showModal({ title:'Kurir', message:'Gagal mengubah status' }); return; }
      API.showModal({ title:'Kurir', message:'Status diperbarui' });
      loadShipments();
    }
    (function init(){ loadShipments(); })();
  </script>
</body>
</html>
