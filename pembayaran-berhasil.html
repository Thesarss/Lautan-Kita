<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pembayaran Berhasil - Laut Kita</title>
  <link rel="stylesheet" href="pembayaran.css" />
</head>
<body>
  <div class="container">
    <button class="back-btn" onclick="window.location.href='home_final.html'">‚Üê</button>
    <div style="display:flex;align-items:center;gap:8px;margin-top:10px">
      <img id="userAvatarPay" src="img/pembeli.png" alt="Avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover">
      <span style="color:#07304A;font-weight:600">Akun Anda</span>
    </div>


    <img src="img/assetspayment-success.png" alt="Pembayaran Berhasil" class="payment-img" />

    <h1>Pembayaran Berhasil!</h1>
    <p class="subtitle">Pembayaran anda telah dikonfirmasi</p>

    <div class="info-box">
      <p>Pesanan anda sedang diproses dan akan segera dikirim.<br>
      Jangan lupa untuk memberikan review saat paket tiba.</p>
      <a href="#" id="orderDetailLink" class="link">Lihat rincian pesanan</a>
    </div>
  </div>
  <script src="assets/js/api.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async function(){
      const img = document.getElementById('userAvatarPay');
      const token = localStorage.getItem('auth_token');
      if (!token) return;
      try{
        const resp = await API.authFetch('/auth/me');
        if (!resp.ok) return;
        const u = await resp.json();
        if (u.avatar_url) img.src = API.base + u.avatar_url;
      }catch{}

      // Set up order detail link
      const orderDetailLink = document.getElementById('orderDetailLink');
      try {
        const currentOrder = JSON.parse(localStorage.getItem('currentOrder') || '{}');
        if (currentOrder.pesanan_id) {
          orderDetailLink.href = `rincian-pesanan.html?id=${currentOrder.pesanan_id}`;
        } else {
          orderDetailLink.href = 'dashboard-pembeli.html';
          orderDetailLink.textContent = 'Lihat Dashboard';
        }
      } catch (e) {
        orderDetailLink.href = 'dashboard-pembeli.html';
        orderDetailLink.textContent = 'Lihat Dashboard';
      }
    });
  </script>
</body>
</html>
